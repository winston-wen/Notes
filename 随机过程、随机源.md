# 1. 随机过程

​	任意一局游戏都可以抽象出这样的数学模型：连续地抛一枚不均匀硬币，硬币正面朝上的概率是抛掷次数的函数，记为 $h(n)$。为了行文简洁，我们称每次抛掷为一“步”。硬币第一次正面朝上、或抛掷 $N$ 步后停止抛掷。记停止抛掷时的步数为 $n_0$，显然 $1\le n_0 \le N$。玩家在第 $n$ 步触发按钮；若 $n<n_0$ ，则玩家胜利。显然 $0\le n \le N-1$。

​	我们不直接设计 $h(n)$ ，而是先设计“玩家猜$n$并取胜的奖励倍率” $g(n)$。$g(n)$ 是主观设定的，我们设定为公式$\eqref{gn}$。

$$
\begin{align}
g(n)&=0.01+2^{vn^{1.5}} ~,\\
N&=1000~, \\
v&=\log_2(800-0.01)/800^{1.5}~.
\end{align}
\tag{gn}\label{gn}
$$

​	接下来，设 $w(n)$ 为“玩家猜$n$取胜”的概率，$p(n)$ 为“游戏停止于第$n$步”的概率。显然，

$$
w(n)=\sum_{u=n+1}^N p(u) ~. \tag{wn}\label{wn}
$$

​	我们希望玩家不论猜哪个 $n$，奖励倍率的期望都是一个常数 $a$。从而对任意 $0\le n \le N-1$，有公式$\eqref{wngn}$所示的约束。有了公式$\eqref{wn}$和$\eqref{wngn}$ ，我们就可以采用计算机迭代的方式，得到 $p(n)$ 的函数值表。

$$
w(n)g(n)=a \tag{wngn}\label{wngn}
$$

​	接下来，我们仍然采用计算机迭代的方式得到 $h(n)$ 的函数值表，原理如公式$\eqref{pn}$和$\eqref{hn}$所示。其中， $h(1) \in [0,1]$ 是一个常数，用于刻画“游戏一开始就停止的概率”。
$$
p(n)=\begin{cases}
h(1) & ,~ n=1 \\ \\
h(n)\prod_{u=0}^{n-1}(1-h(u)) & ,~ 1<n \le N ~~.
\end{cases}
\tag{pn}\label{pn}
$$

​	观察 $p(n)$ 的前几项，可以猜想 $h(n)$ 满足如公式(hn)所示的递推关系。我们可以用数学归纳法证明公式$\eqref{hn}$，这里省略证明过程。
$$
h(n)=\dfrac{p(n)}{1-\sum_{u=1}^{n-1}p(u)}
\tag{hn}\label{hn}
$$

​	最后，设随机事件 $Y(n)$ 代表硬币“在第$n$步时是否正面朝上”，如公式$\eqref{yn}$所示。其中，参数 $M$ 是一个足够大的正整数；函数 $r(n)$ 是第 $n$ 步所采集的随机整数，其服从区间 $[0,M]$ 上的均匀分布；符号 $[[x]]$ 是四舍五入取整。
$$
Y(n)=\Big(r(n)<=[[h(n)\cdot M]]\Big) \tag{yn}\label{yn}
$$

# 2. 随机数生成器

​	公式$\eqref{yn}$涉及到随机整数 $r(n)$。为了保证公平性，即中心化平台不能随意指定 $r(n)$ 的值，我们提出如下计算 $r(n)$ 的方法：

​	玩家在任意第 $n$ 步触发按钮时，将向平台提交一些即时信息，包括但不限于：玩家名称、触发按钮的毫秒时间戳、玩家附言，等等。我们记这样的即时信息为 $\mathrm{msg}_{n,i}$，这里 $i$ 是第 $n$ 步触发按钮的玩家编号。偶然情况下，某一步没有玩家提交即时信息。因此还需引入外部的、中立的随机数源 $R(n)$，例如BTC的行情、游戏中的弹幕等。
​	如此，每一步将得到形如公式$\eqref{sn}$所示的随机数 $s(n)$。其中，$H$ 为密码学哈希函数；若 $H$ 有多个输入，则把它们拼接为一个输入。
$$
s(n)=H\Big(H(R(n)),H(\mathrm{msg}_{n,1}),H(\mathrm{msg}_{n,2}),\cdots\mathrm{finitely}\Big)
\tag{sn}\label{sn}
$$
​	为了彻底剥夺中心化平台预言 $r(n)$ 的能力，我们不能直接把 $s(n)$ 当 $r(n)$ 用，而需引入有限个 $s(n+1)$, $s(n+2)$, $\cdots$, $s(n+k)$ 来决定 $r(n)$。具体来说，有公式$\eqref{rnsn}$。如此，$Y(n)$ 将由第 $n$ 步以及未来的 $k-1$ 步共同决定。停止抛掷的步数 $n_0$ 为使 $Y(n)=1$ 的最早步数。

$$
r(n)=H\Big(s(n+1), s(n+2), \cdots, s(n+k)\Big) ~.
\tag{rnsn}\label{rnsn}
$$
